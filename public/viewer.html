<!DOCTYPE html>
<html>
<head>
<title>RobotQuest: Viewer</title>

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/async.min.js"></script>
<script src="/demo/api.js"></script>
<style>

@font-face {
    font-family: robot;
    src: url('/assets/robot.ttf')  format('truetype');
}

@font-face {
    font-family: robothead;
    src: url(/assets/robothead.ttf) format('truetype');
}

@font-face {
    font-family: knightsquest;
    src: url(/assets/knightsquest.ttf) format('truetype');
}

    * {
        box-sizing: border-box;
    }



    header {
        font-family: knightsquest;
        color: #FFF;
        position: fixed;
        top: 0px;
        left: 0px;
        width: 160px;
        background: url(/assets/headerbg2.png);
        height: 100%;
        padding: 5px;
    }

    header #logo {
        display: block;
        float: left;
        width: 64px;
        height: 64px;
    }

    header .title {
        font-size: 32px;
        text-transform: uppercase;
        margin-top: -3px;
        margin-left: 69px;
    }

    header .links {
        clear:both;
        margin-top: 10px;
    }

    header .links a {
        font-family: knightsquest; 
        color: #FFF;
        font-size: 26px;
        padding: 5px;
    }

    header .robot {
        font-family: robothead;
    }

    header .quest {
        font-family: knightsquest;
        font-size: 26px;
    }


    #botInfo {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
        background-color: rgba(0, 0, 0, 0.6);
        display: none;
    }

    #botInfo .inside {
        background-color: #FFF;
        width: 200px;
        height: 100px;
        margin-top: 100px;
        margin: 100px auto;
    }



    body {
        padding: 0px;
        margin: 0px;
        background: url(/assets/headerbg.png);
    }

    #container {
        background-color: #F00;
        background: url(/assets/headerbg.png);
        padding: 32px;
        margin-left: 160px;
    }

    #viewer {
        background: url(/assets/angbandtk/bgtile.png) #5c5;
        box-shadow: inset 0px 0px 50px 0px rgba(0, 0, 0, 0.8);
        position: relative;
    }

    .bot {
        /*background-color: #000;*/
        width: 32px;
        height: 32px;
        position: absolute;

        /*background: url(/assets/angbandtk/dg_classm32.gif);*/

        transition: all linear 300ms;
        -webkit-transition: all linear 300ms;
    }

    .bot:hover {
        box-shadow: inset 0px 0px 5px 5px #FCF766;
    }

    .info {
        float: right;
        margin: 15px;
    }

    /* set background-position with javascript */

    .sprite {
        width: 32px;
        height: 32px;
    }

    .sprite.classm {
        background: url(/assets/angbandtk/dg_classm32.gif);
    }

    .sprite.dragon {
        background: url(/assets/angbandtk/dg_dragon32.gif);
    }

    .sprite.humans {
        background: url(/assets/angbandtk/dg_humans32.gif);
    }

    .sprite.misc {
        background: url(/assets/angbandtk/dg_misc32.gif);
    }

    .sprite.people {
        background: url(/assets/angbandtk/dg_people32.gif);
    }

    .sprite.undead {
        background: url(/assets/angbandtk/dg_undead32.gif);
    }

    .sprite.uniques {
        background: url(/assets/angbandtk/dg_uniques32.gif);
    }

    .sprite.monster1 {
        background: url(/assets/angbandtk/dg_monster132.gif);
    }

    .sprite.monster2 {
        background: url(/assets/angbandtk/dg_monster232.gif);
    }

    .sprite.monster3 {
        background: url(/assets/angbandtk/dg_monster332.gif);
    }
    
    .sprite.monster4 {
        background: url(/assets/angbandtk/dg_monster432.gif);
    }

    .sprite.monster5 {
        background: url(/assets/angbandtk/dg_monster532.gif);
    }

    .sprite.monster6 {
        background: url(/assets/angbandtk/dg_monster632.gif);
    }

    .sprite.monster7 {
        background: url(/assets/angbandtk/dg_monster732.gif);
    }

    /* let's go for 30% */

</style>
<script>
    $(function() {

        var bots = []

        var $window = $(window)
        var $viewer = $("#viewer")
        var $container = $("#container")
        var $botInfo = $("#botInfo")

        var PX = 32
        var PY = 32

        var padding = 0

        $window.on('resize', function() {
            console.log("RESIZE")
        })

        // first, get the world
        $.get("/game", function(gameInfo) {

            var w = gameInfo.width
            var h = gameInfo.height
            var ms = gameInfo.tick

            // this will make it scroll
            $viewer.css({width: w * PX, height: h * PY})
            $container.css({width: (w+2)*PX, height: (h+2)*PY})

            console.log("GAME INFO", w, h, ms)

            function poll() {
                $.get("/game/minions", function(bots) {
                    tick(bots)
                })
            }

            function tick(bots) {

                $(".bot").addClass("inactive")

                bots.forEach(function(bot) {
                    var $bot = $("#" + bot.id)

                    if (!$bot.length) {
                        console.log("NEW BOT", bot.id, bot.name, bot.x, bot.y)
                        $bot = botView(bot)
                        $viewer.append($bot)
                    }

                    $bot.css({left: (bot.x) * PX + padding, top: (bot.y) * PY + padding})
                    // $bot.css({width: PX, height: PY})
                    $bot.removeClass("inactive")
                })

                $(".bot.inactive").remove()
            }

            function botView(bot) {
                var $bot = $("<a href='/bots/"+bot.id+"' class='bot sprite undead' id='"+bot.id+"'></a>")
                $bot.data(bot)
                // compute offset mathematically
                // dragon-3-4
                var xi = 3
                var yi = 4
                $bot.css({'background-position': '-' + xi*32 + 'px -' + yi*32 + 'px'})
                return $bot
            }

            poll()
            setInterval(poll, ms)
        })

        // show information about a bot in the game
        function showBot(bot) {
            $botInfo.show()
        }

        $viewer.on("click", ".bot", function(event) {
            showBot()
            return false
        })

        $botInfo.click(function(e) {
            $botInfo.hide()
            return false
        })


    })
</script>

</head>
<body>


<div id="container">
<div id="viewer">
</div>
</div>

<header>
    <img id="logo" src="/assets/logo2.png" alt="RobotQuest">
    <div class="title"><div class='robot'>Robot</div><div class='quest'>Quest</div></div>

    <div class="links">
        <a href="/documentation.html">What is this?</a>
    </div>

    <h2>Killers</h2>
    <table>
        <tr><th>Kills</th><th>Bot</th><th>Player</th></tr>
        <tr><td>245</td><td>wozniak-1</td><td>Bob</td></tr>
        <tr><td>31</td><td>Henry</td></tr>
    </table>
    <h2>Survivors</h2>
</header>

<div id="botInfo">
    <div class="inside">
      hello
    </div>
</div>

</body>
