<!DOCTYPE html>
<html>
<head>

<script src="/assets/js/jquery.min.js"></script>
<script src="/demo/viewer.js"></script>
<style>
    #viewer {
        border: solid 1px black;
        margin: 0px auto;
    }
</style>
<script>
    $(function() {
        viewer("#viewer").start()

        var point = {x: 3, y: 3}

        call("POST", "/units", {requestedPoint: point, unitDescription: {source: "source", notes:"notes"}}, "", function(err, spawn) {

            if (err) throw err

            var unitId = spawn.unitId
            point = spawn.spawnPoint
            var unitToken = spawn.unitToken

            var interval = setInterval(function() {
                var newPoint = {x: point.x + 1, y: point.y}
                call("POST", "/units/" + unitId + "/move", newPoint, unitToken, function(err) {
                    point = newPoint
                })
            }, 1000)
        })

        function call(method, url, body, authToken, cb) {
            $.ajax( { type: method
                    , url: url
                    , contentType: 'application/json'
                    , data: JSON.stringify(body)
                    , dataType: "json"
                    , headers: {"X-Auth-Token":authToken}
                    , error: function(xhr) {
                        cb(new Error(xhr.responseText))
                    }
                    , success: function(data) {
                        cb(null, data)
                    }
                })
        }
    })
</script>

</head>
<body>
    <canvas id="viewer" width="100" height="100"></canvas>
</body>
